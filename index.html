<script type=module>var t,e,n,s=Object.defineProperty,i=Object.defineProperties,o=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(t,e,n)=>e in t?s(t,e,{t:!0,i:!0,writable:!0,value:n}):t[e]=n,h=(t,e)=>{for(var n in e||(e={}))a.call(e,n)&&u(t,n,e[n]);if(r)for(var n of r(e))c.call(e,n)&&u(t,n,e[n]);return t},l=(t,e)=>i(t,o(e)),f=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},d=(t,e,n)=>(f(t,e,"read from private field"),n?n.call(t):e.get(t)),p=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},x=(t,e,n,o)=>(f(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);const w=document.getElementsByTagName("canvas")[0],y=w.getContext("2d");function M(){y.fillStyle="#121212",y.fillRect(0,0,w.width,w.height)}function v(t,e){return n=t.x-e.x,o=t.y-e.y,Math.atan2(o,n);var n,o}function S(t,e=1){return{x:Math.cos(t)*e,y:Math.sin(t)*e}}class b{constructor(e){var n,o,s;p(this,t,void 0),this.o=l(h({},e),{dx:null!=(n=e.dx)?n:0,dy:null!=(o=e.dy)?o:0}),x(this,t,null==(s=e.u)||s)}h(){}l(t,e){}get u(){return d(this,t)}set u(e){x(this,t,e)}}t=new WeakMap;class m extends b{constructor(t){var e;super(t),this.p=null!=(e=t.p)?e:0}}class g extends m{constructor(t){var e,n,o,s;super(t),this.M=null!=(e=t.M)?e:10,this.v=null!=(n=t.v)?n:"#fff",this.orientation=null!=(o=t.orientation)?o:0,this.S=null!=(s=t.S)?s:0}h(){y.beginPath(),y.fillStyle=function(t,e,n,o,s,i,r){const a=y.createLinearGradient(n,o,n+Math.cos(r)*s,o+Math.sin(r)*i);return a.addColorStop(0,t),a.addColorStop(1,"#000"),a}(this.v,0,this.o.x,this.o.y,2*this.M,2*this.M,this.orientation),y.arc(this.o.x,this.o.y,this.M,0,2*Math.PI),y.fill()}l(t,e){super.l(t,e),this.orientation=(this.orientation+this.S*e/1e3)%(2*Math.PI)}}class j extends g{constructor(t){var e;super(t),this.points=null!=(e=t.points)?e:1}}class F extends g{constructor(t){var e,n,o;super(l(h({},t),{M:null!=(e=t.M)?e:10,v:null!=(n=t.v)?n:"#fff",p:null!=(o=t.p)?o:40,u:!1})),this.m=1,this.g=0,this.j=null,this.u=!1}h(){super.h();const{o:t,g:e,M:n,orientation:o}=this;if(!e)return;y.save(),y.fillStyle="#e43",y.translate(t.x,t.y),y.rotate(o-Math.PI/2);const s=n,i=s/2,r=-i,a=n+i+e;y.fillRect(r,a,s,-e),function(t,...e){y.beginPath(),y.moveTo(...t),e.forEach(t=>{y.lineTo(...t)}),y.fill()}([r,a],[r+s,a],[0,a+i]),y.restore()}l(t,e){super.l(t,e);const n=this.j;if(null!==n){const{F:t,P:e}=n;this.orientation=t.orientation+e;const o=this.M+t.M,{x:s,y:i}=S(this.orientation,o);this.o.x=t.o.x+s,this.o.y=t.o.y+i,this.o.dx=0,this.o.dy=0}}get u(){return super.u}set u(t){super.u=t,!1===t&&(this.j=null)}}class P extends g{constructor(t){var e,n;super(l(h({},t),{p:null!=(e=t.p)?e:30,M:null!=(n=t.M)?n:30,u:!0}))}}class k extends P{constructor(t){super(t),this.k=t.k}h(){super.h(),y.fillStyle=function(t,e,n,o,s){const i=y.createRadialGradient(n,o,0,n,o,s);return i.addColorStop(0,"transparent"),i.addColorStop(1,e),i}(0,this.k,this.o.x,this.o.y,this.M),y.arc(this.o.x,this.o.y,this.M,0,2*Math.PI),y.fill()}}class E extends j{constructor(t){var e,n;super(l(h({},t),{M:null!=(e=t.M)?e:3,v:null!=(n=t.v)?n:"#afa",u:!1})),this.F=t.F,this.O=(.1*Math.random()+.1)*(Math.random()<.5?-1:1),this.T=Math.random()*Math.PI*2,this.altitude=50*Math.random()+100}}class O extends g{constructor(t){var e,n,o;super(l(h({},t),{p:null!=(e=t.p)?e:3,M:null!=(n=t.M)?n:5,v:null!=(o=t.v)?o:"#d55",u:!1}))}}class z extends b{constructor(t){var e;super(t),this.fontSize=null!=(e=t.fontSize)?e:12,this.text=t.text}h(){super.h(),y.fillStyle="#EEE",y.font=this.fontSize+"px sans-serif";const t=y.measureText(this.text).width;y.fillText(this.text,this.o.x-t/2,this.o.y)}}function T(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}function A(){return parseInt(window.localStorage.getItem("planethoppers-level")||"0")}function W(t){window.localStorage.setItem("planethoppers-level",t.toString())}function C(t,e,n){const o=n.A;if(e instanceof j&&(n.points+=e.points,function(t){const{W:e}=t;null!=e&&t.points>=e&&et()}(n),T(o,e)),e instanceof P&&!t.u){let n;t.u=!0,s=t.o,i=e.o,n=s.x===i.x&&s.y===i.y&&s.dx==s.dx&&s.dy===i.dy?t.orientation:v(t.o,e.o)-e.orientation,t.j={F:e,P:n}}var s,i;e instanceof k&&et(),e instanceof O&&(X=Q[V]())}function D(t,e){const n=t.M+e.M;return function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}(t.o,e.o)<n}function G(t,e){const n=e.A;n.forEach(o=>{o===t||o instanceof F||(t instanceof F?o instanceof g&&D(t,o)&&C(t,o,e):o instanceof g&&t instanceof g&&D(o,t)&&(T(n,t),o.u||T(n,o)))})}function H(t){return()=>{const e=t(),{A:n}=e,o={points:0,A:n,W:e.W};return G(n.find(t=>t instanceof F),o),o}}function L(t,e){const n=new P(t),o=new Array(e).fill(0).map(t=>new E({x:0,y:0,F:n}));return[n,...o]}const R=H(()=>({A:[new F({x:400,y:200,orientation:Math.PI/4}),new P({x:400,y:200,v:"#f00"}),new k({x:800,y:300,v:"#f00",k:"#ff26"}),new z({x:640,y:450,fontSize:32,text:"Welcome to Planet Hoppers!"}),new z({x:640,y:500,fontSize:24,text:"Hold the spacebar to charge your jump"}),new z({x:640,y:550,fontSize:24,text:"release to get to your destination planet!"})]})),$=H(()=>({A:[new F({x:100,y:100,orientation:Math.PI}),new P({x:100,y:100,v:"#0f0",S:.5}),new k({x:300,y:300,v:"#f00",k:"#ff26"}),new z({x:640,y:450,fontSize:32,text:"Some planets will rotate"}),new z({x:640,y:500,fontSize:24,text:"Time your jump just right to get to the destination planet"})]})),q=H(()=>({A:[new F({x:100,y:100,orientation:.75*Math.PI}),new P({x:100,y:100,v:"#0f0"}),new P({x:300,y:300,v:"#ff0",S:.5}),new k({x:700,y:400,v:"#f00",k:"#ff26"})]})),I=H(()=>({W:3,A:[new F({x:300,y:300,orientation:1.5*Math.PI}),...L({x:300,y:300,v:"#0f0",S:1},3),new z({x:640,y:450,fontSize:32,text:"Collect space debris along your way for points"})]}));class U extends b{constructor(t,o){var s;super(t),p(this,e,void 0),p(this,n,void 0),this.C=1e3/t.D,this.G=t.G,this.H=null!=(s=t.H)?s:.1,x(this,e,0),x(this,n,o)}l(t,o){super.l(t,o);const{o:s,C:i,H:r,G:a}=this;for(x(this,e,d(this,e)+o);d(this,e)>i;){console.log("spawning"),x(this,e,d(this,e)-i);const o=r*Math.cos(a),c=r*Math.sin(a);t.A.push(new O(l(h({},d(this,n)),{x:s.x,y:s.y,dx:o,dy:c})))}}}e=new WeakMap,n=new WeakMap;const B=H(()=>({A:[new F({x:300,y:300,orientation:1.5*Math.PI}),new U({x:600,y:700,D:2,G:1.1*Math.PI,H:.2}),new U({x:800,y:600,D:2,G:1.3*Math.PI,H:.2}),new P({x:300,y:300,v:"#0f0",S:1}),new k({x:600,y:600,v:"#333",k:"#ff0"}),new z({x:640,y:450,fontSize:32,text:"Avoid asteroids at all costs!"})]}));function J(t,e,n){y.strokeStyle="#eee",y.font=e+"em sans-serif";const o=w.width/2,s=y.measureText(t).width;y.strokeText(t,o-s/2,n)}let K=!1;const N=new class{constructor(){this.L=0,this.R="#ffe",this.$=3,this.q=200,this.I=[...Array(100)].map(t=>[Math.round(2e3*Math.random()),Math.round(2e3*Math.random())])}update(t){this.L+=t}U(){const t=this.$,e=this.q;let n=Math.round(this.L/e);this.I.forEach(([e,o])=>{switch(n=(n+1)%4,y.fillStyle=this.R,n){case 0:y.fillRect(e,o,t,t);break;case 1:case 3:y.fillRect(e-t,o,3*t,t),y.fillRect(e,o-t,t,3*t);break;case 2:y.fillRect(e-t,o,3*t,t),y.fillRect(e,o-t,t,3*t),y.fillStyle="#121212",y.fillRect(e,o,t,t)}})}},Q=[R,$,q,I,B];let V=A();V>=Q.length&&(W(0),V=A());let X=Q[V]();function Y(t,e){const n=t.A;N.update(e);const o=n.find(t=>t instanceof F);if(K){if(o.u){const t=.2*o.m*e;let n=o.g+t;n>100?(o.m=-1,n-=n-100):n<0&&(o.m=1,n=Math.abs(n)),o.g=n}}else{const t=o.g;if(t){o.g=0,o.m=1,o.u=!1;const{x:e,y:n}=S(o.orientation,.002*t);o.o.dx=e,o.o.dy=n}}n.forEach(n=>n.l(t,e));const s=n.filter(t=>t instanceof m);s.filter(t=>!t.u).forEach(n=>{var o;if(n instanceof E)return void function(t,e){t.T+=t.O*(e/1e3),t.o.x=t.altitude*Math.cos(t.T)+t.F.o.x,t.o.y=t.altitude*Math.sin(t.T)+t.F.o.y}(n,e);n.o=null!=(o=n.o)?o:{dx:0,dy:0};let i=0,r=0;s.forEach(t=>{if(n===t)return;if(n instanceof F&&!t.u)return;const e=t.o.x-n.o.x||1e-8,o=t.o.y-n.o.y||1e-8,s=Math.sqrt(Math.pow(e,2)+Math.pow(o,2)),a=4e-5*n.p/(s*Math.sqrt(s+.5));i+=e*a,r+=o*a}),n.o.dx+=i*e,n.o.dy+=r*e,n instanceof g&&(n.orientation=Math.atan2(r,i)),n.o.x+=n.o.dx*e,n.o.y+=n.o.dy*e,G(n,t)})}let Z=!1,_=0;function tt(t){if(Z)return M(),y.fillStyle="#222",y.fillRect(0,0,w.width,w.height),J("Planet Hoppers",6,150),void J("Press Space to Resume",3,300);M();const e=X.A,n=t-_;var o;_=t,console.debug("FPS: "+1e3/n),Y(X,n),N.U(),e.forEach(t=>{t.h()}),o=X,y.fillStyle="#eee",y.font="30px sans-serif",y.fillText("Points: "+o.points,10,40)}function et(){W(++V),X=Q[V]()}function nt(){Z=!0}function st(t){switch(t.key){case"Escape":return void nt();case" ":return t.preventDefault(),Z&&(Z=!1),void(K=!0);case"r":return W(0),void location.reload();default:console.debug("Unhandled keypress",t.key)}}function it(t){switch(t.key){case" ":t.preventDefault(),K=!1}}!function(){const t=e=>{tt(e),requestAnimationFrame(t)};requestAnimationFrame(t),addEventListener("blur",nt),addEventListener("keydown",st),addEventListener("keyup",it)}()</script><style>*{margin:0;overflow:hidden}</style><div style=width:100%;height:100%;background-color:#0e0e0e><div style=width:1280;margin:auto><canvas width=1280 height=720 /></div></div>