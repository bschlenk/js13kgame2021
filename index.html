<script type=module>var t,e,n,s=Object.defineProperty,i=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(t,n,e)=>n in t?s(t,n,{t:!0,i:!0,writable:!0,value:e}):t[n]=e,h=(t,n)=>{for(var e in n||(n={}))o.call(n,e)&&u(t,e,n[e]);if(r)for(var e of r(n))c.call(n,e)&&u(t,e,n[e]);return t},f=(t,n)=>i(t,a(n)),l=(t,n,e)=>{if(!n.has(t))throw TypeError("Cannot "+e)},d=(t,n,e)=>(l(t,n,"read from private field"),e?e.call(t):n.get(t)),x=(t,n,e)=>{if(n.has(t))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(t):n.set(t,e)},p=(t,n,e,o)=>(l(t,n,"write to private field"),o?o.call(t,e):n.set(t,e),e);const w=document.getElementsByTagName("canvas")[0],M=w.getContext("2d");function v(){w.width=window.innerWidth,w.height=window.innerHeight}function y(){M.fillStyle="#121212",M.fillRect(0,0,w.width,w.height)}function b(t,n,e,o,s){M.translate(t,n),M.rotate(s),M.translate(-t,-n),M.fillRect(t,n,e,o),M.setTransform(1,0,0,1,0,0)}function m(t,n){return e=t.x-n.x,o=t.y-n.y,Math.atan2(o,e);var e,o}function S(t,n=1){return{x:Math.cos(t)*n,y:Math.sin(t)*n}}class j{constructor(n){var e,o,s;x(this,t,void 0),this.o=f(h({},n),{dx:null!=(e=n.dx)?e:0,dy:null!=(o=n.dy)?o:0}),p(this,t,null==(s=n.u)||s)}h(){}l(t,n){}get u(){return d(this,t)}set u(n){p(this,t,n)}}t=new WeakMap;class g extends j{constructor(t){var n;super(t),this.p=null!=(n=t.p)?n:0}}class F extends g{constructor(t){var n,e,o,s;super(t),this.M=null!=(n=t.M)?n:10,this.v=null!=(e=t.v)?e:"#fff",this.orientation=null!=(o=t.orientation)?o:0,this.m=null!=(s=t.m)?s:0}h(){M.beginPath(),M.fillStyle=function(t,n,e,o,s,i,r){const a=M.createLinearGradient(e,o,e+Math.cos(r)*s,o+Math.sin(r)*i);return a.addColorStop(0,t),a.addColorStop(1,"#000"),a}(this.v,0,this.o.x,this.o.y,2*this.M,2*this.M,this.orientation),M.arc(this.o.x,this.o.y,this.M,0,2*Math.PI),M.fill()}l(t,n){super.l(t,n),this.orientation=(this.orientation+this.m*n/1e3)%(2*Math.PI)}}class k extends F{constructor(t){var n;super(t),this.points=null!=(n=t.points)?n:1}}class P extends F{constructor(t){var n,e,o;super(f(h({},t),{M:null!=(n=t.M)?n:10,v:null!=(e=t.v)?e:"#fff",p:null!=(o=t.p)?o:40,u:!1})),this.S=1,this.j=0,this.g=null,this.u=!1}h(){super.h();const{o:t,j:n,M:e,orientation:o}=this;if(!n)return;M.fillStyle="#e43";const s=e;b(t.x+(e+s/2)*Math.cos(o),t.y+(e+s/2)*Math.sin(o),s,n,o-Math.PI/2)}l(t,n){super.l(t,n);const e=this.g;if(null!==e){const{F:t,k:n}=e;this.orientation=t.orientation+n;const o=this.M+t.M,{x:s,y:i}=S(this.orientation,o);this.o.x=t.o.x+s,this.o.y=t.o.y+i,this.o.dx=0,this.o.dy=0}}get u(){return super.u}set u(t){super.u=t,!1===t&&(this.g=null)}}class O extends F{constructor(t){var n,e;super(f(h({},t),{p:null!=(n=t.p)?n:30,M:null!=(e=t.M)?e:30,u:!0}))}}class E extends O{constructor(t){super(t),this.P=t.P}h(){super.h(),M.fillStyle=function(t,n,e,o,s){const i=M.createRadialGradient(e,o,0,e,o,s);return i.addColorStop(0,"transparent"),i.addColorStop(1,n),i}(0,this.P,this.o.x,this.o.y,this.M),M.arc(this.o.x,this.o.y,this.M,0,2*Math.PI),M.fill()}}class T extends k{constructor(t){var n,e;super(f(h({},t),{M:null!=(n=t.M)?n:3,v:null!=(e=t.v)?e:"#afa",u:!1})),this.F=t.F,this.O=(.1*Math.random()+.1)*(Math.random()<.5?-1:1),this.T=Math.random()*Math.PI*2,this.altitude=50*Math.random()+100}}class A extends F{constructor(t){var n,e,o;super(f(h({},t),{p:null!=(n=t.p)?n:3,M:null!=(e=t.M)?e:5,v:null!=(o=t.v)?o:"#d55",u:!1}))}}function L(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}function W(t,n,e){const o=e.A;if(n instanceof k&&(e.points+=n.points,function(t){const{L:n}=t;null!=n&&t.points>=n&&tt()}(e),L(o,n)),n instanceof O&&!t.u){let e;t.u=!0,s=t.o,i=n.o,e=s.x===i.x&&s.y===i.y&&s.dx==s.dx&&s.dy===i.dy?t.orientation:m(t.o,n.o)-n.orientation,t.g={F:n,k:e}}var s,i;n instanceof E&&tt(),n instanceof A&&(V=N[Q]())}function C(t,n){const e=t.M+n.M;return function(t,n){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}(t.o,n.o)<e}function D(t,n){const e=n.A;e.forEach(o=>{o===t||o instanceof P||(t instanceof P?o instanceof F&&C(t,o)&&W(t,o,n):o instanceof F&&t instanceof F&&C(o,t)&&(L(e,t),o.u||L(e,o)))})}function G(t){return()=>{const n=t(),{A:e}=n,o={points:0,A:e,L:n.L};return D(e.find(t=>t instanceof P),o),o}}function R(t,n){const e=new O(t),o=new Array(n).fill(0).map(t=>new T({x:0,y:0,F:e}));return[e,...o]}const q=G(()=>({A:[new P({x:100,y:100,orientation:Math.PI/4}),new O({x:100,y:100,v:"#f00"}),new E({x:300,y:300,v:"#f00",P:"#ff26"})]})),$=G(()=>({A:[new P({x:100,y:100,orientation:Math.PI}),new O({x:100,y:100,v:"#0f0",m:.3}),new E({x:300,y:300,v:"#f00",P:"#ff26"})]})),z=G(()=>({A:[new P({x:100,y:100,orientation:.75*Math.PI}),new O({x:100,y:100,v:"#0f0"}),new O({x:300,y:300,v:"#ff0",m:.5}),new E({x:700,y:400,v:"#f00",P:"#ff26"})]})),H=G(()=>({L:1,A:[new P({x:300,y:300,orientation:1.5*Math.PI}),...R({x:300,y:300,v:"#0f0",m:1},3)]}));class U extends j{constructor(t,o){var s;super(t),x(this,e,void 0),x(this,n,void 0),this.W=1e3/t.C,this.D=t.D,this.G=null!=(s=t.G)?s:.1,p(this,e,0),p(this,n,o)}l(t,o){super.l(t,o);const{o:s,W:i,G:r,D:a}=this;for(p(this,e,d(this,e)+o);d(this,e)>i;){console.log("spawning"),p(this,e,d(this,e)-i);const o=r*Math.cos(a),l=r*Math.sin(a);t.A.push(new A(f(h({},d(this,n)),{x:s.x,y:s.y,dx:o,dy:l})))}}}e=new WeakMap,n=new WeakMap;const B=G(()=>({A:[new P({x:300,y:300,orientation:1.5*Math.PI}),new U({x:600,y:700,C:2,D:1.1*Math.PI,G:.2}),new U({x:800,y:600,C:2,D:1.3*Math.PI,G:.2}),new O({x:300,y:300,v:"#0f0",m:1}),new E({x:600,y:600,v:"#333",P:"#ff0"})]}));function I(t,n,e){M.strokeStyle="#eee",M.font=n+"em sans-serif";const o=w.width/2,s=M.measureText(t).width;M.strokeText(t,o-s/2,e)}let J=!1;const K=new class{constructor(){this.R=0,this.q="#ffe",this.$=3,this.H=200,this.U=[...Array(100)].map(t=>[Math.round(2e3*Math.random()),Math.round(2e3*Math.random())])}update(t){this.R+=t}B(){const t=this.$,n=this.H;let e=Math.round(this.R/n);this.U.forEach(([n,o])=>{switch(e=(e+1)%4,M.fillStyle=this.q,e){case 0:M.fillRect(n,o,t,t);break;case 1:case 3:M.fillRect(n-t,o,3*t,t),M.fillRect(n,o-t,t,3*t);break;case 2:M.fillRect(n-t,o,3*t,t),M.fillRect(n,o-t,t,3*t),M.fillStyle="#121212",M.fillRect(n,o,t,t)}})}},N=[q,$,z,H,B];let Q=0,V=N[Q]();function X(t,n){const e=t.A;K.update(n);const o=e.find(t=>t instanceof P);if(J){if(o.u){const t=.2*o.S*n;let e=o.j+t;e>100?(o.S=-1,e-=e-100):e<0&&(o.S=1,e=Math.abs(e)),o.j=e}}else{const t=o.j;if(t){o.j=0,o.S=1,o.u=!1;const{x:n,y:e}=S(o.orientation,.002*t);o.o.dx=n,o.o.dy=e}}e.forEach(e=>e.l(t,n));const s=e.filter(t=>t instanceof g);s.filter(t=>!t.u).forEach(e=>{var o;if(e instanceof T)return void function(t,n){t.T+=t.O*(n/1e3),t.o.x=t.altitude*Math.cos(t.T)+t.F.o.x,t.o.y=t.altitude*Math.sin(t.T)+t.F.o.y}(e,n);e.o=null!=(o=e.o)?o:{dx:0,dy:0};let i=0,r=0;s.forEach(t=>{if(e===t)return;if(e instanceof P&&!t.u)return;const n=t.o.x-e.o.x||1e-8,o=t.o.y-e.o.y||1e-8,s=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),a=2e-5*e.p/(s*Math.sqrt(s+.15));i+=n*a,r+=o*a}),e.o.dx+=i*n,e.o.dy+=r*n,e instanceof F&&(e.orientation=Math.atan2(r,i)),e.o.x+=e.o.dx*n,e.o.y+=e.o.dy*n,D(e,t)})}let Y=!1,Z=0;function _(t){if(Y)return y(),M.fillStyle="#222",M.fillRect(0,0,w.width,w.height),I("Planet Hoppers",6,150),void I("Press Space to Resume",3,300);y();const n=V.A,e=t-Z;var o;Z=t,console.debug("FPS: "+1e3/e),X(V,e),K.B(),n.forEach(t=>{t.h()}),o=V,M.fillStyle="#eee",M.font="30px sans-serif",M.fillText("Points: "+o.points,10,40)}function tt(){V=N[++Q]()}function et(){Y=!0}function nt(t){switch(t.key){case"Escape":return void et();case" ":return t.preventDefault(),Y&&(Y=!1),void(J=!0);default:console.debug("Unhandled keypress",t.key)}}function st(t){switch(t.key){case" ":t.preventDefault(),J=!1}}!function(){const t=n=>{_(n),requestAnimationFrame(t)};requestAnimationFrame(t),addEventListener("blur",et),addEventListener("keydown",nt),addEventListener("keyup",st),addEventListener("resize",v),v()}()</script><style>*{margin:0;overflow:hidden}</style><canvas/>