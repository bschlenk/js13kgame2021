<script type=module>var t,e,n,s=Object.defineProperty,i=Object.defineProperties,o=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(t,n,e)=>n in t?s(t,n,{t:!0,i:!0,writable:!0,value:e}):t[n]=e,h=(t,n)=>{for(var e in n||(n={}))a.call(n,e)&&u(t,e,n[e]);if(r)for(var e of r(n))c.call(n,e)&&u(t,e,n[e]);return t},l=(t,n)=>i(t,o(n)),f=(t,n,e)=>{if(!n.has(t))throw TypeError("Cannot "+e)},p=(t,n,e)=>(f(t,n,"read from private field"),e?e.call(t):n.get(t)),x=(t,n,e)=>{if(n.has(t))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(t):n.set(t,e)},d=(t,n,e,i)=>(f(t,n,"write to private field"),i?i.call(t,e):n.set(t,e),e);const w=document.getElementsByTagName("canvas")[0],y=w.getContext("2d");function M(){y.fillStyle="#121212",y.fillRect(0,0,w.width,w.height)}function v(t,n){return{x:t,y:n}}function S(t,n){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function b(t,n){return e=t.x-n.x,i=t.y-n.y,Math.atan2(i,e);var e,i}function m(t,n=1){return v(Math.cos(t)*n,Math.sin(t)*n)}class g{constructor(n){var e;x(this,t,void 0),this.position=v(n.x,n.y),this.o=n.o,d(this,t,null==(e=n.u)||e)}h(){}l(t,n){}get u(){return p(this,t)}set u(n){d(this,t,n)}}t=new WeakMap;class j extends g{constructor(t){var n;super(t),this.p=null!=(n=t.p)?n:0}}class P extends j{constructor(t){var n,e,i,o;super(t),this.M=null!=(n=t.M)?n:10,this.v=null!=(e=t.v)?e:"#fff",this.orientation=null!=(i=t.orientation)?i:0,this.S=null!=(o=t.S)?o:0}h(){y.beginPath(),y.fillStyle=function(t,n,e,i,o,s,r){const a=y.createLinearGradient(e,i,e+Math.cos(r)*o,i+Math.sin(r)*s);return a.addColorStop(0,t),a.addColorStop(1,"#000"),a}(this.v,0,this.position.x,this.position.y,2*this.M,2*this.M,this.orientation),y.arc(this.position.x,this.position.y,this.M,0,2*Math.PI),y.fill()}l(t,n){super.l(t,n),this.orientation=(this.orientation+this.S*n/1e3)%(2*Math.PI)}}class F extends P{constructor(t){var n;super(t),this.points=null!=(n=t.points)?n:1}}class k extends P{constructor(t){var n,e,i;super(l(h({},t),{M:null!=(n=t.M)?n:10,v:null!=(e=t.v)?e:"#fff",p:null!=(i=t.p)?i:40,u:!1})),this.m=1,this.g=0,this.j=null,this.u=!1}h(){super.h();const{position:t,g:n,M:e,orientation:i}=this;if(!n)return;y.save(),y.fillStyle="#e43",y.translate(t.x,t.y),y.rotate(i-Math.PI/2);const o=e,s=o/2,r=-s,a=e+s+n;y.fillRect(r,a,o,-n),function(t,...n){y.beginPath(),y.moveTo(...t),n.forEach(t=>{y.lineTo(...t)}),y.fill()}([r,a],[r+o,a],[0,a+s]),y.restore()}l(t,n){super.l(t,n);const e=this.j;if(null!==e){const{P:t,F:n}=e;this.orientation=t.orientation+n;const i=this.M+t.M,{x:o,y:s}=m(this.orientation,i);this.position.x=t.position.x+o,this.position.y=t.position.y+s,this.o=v(0,0)}}get u(){return super.u}set u(t){super.u=t,!1===t&&(this.j=null)}}class E extends P{constructor(t){var n,e;super(l(h({},t),{p:null!=(n=t.p)?n:30,M:null!=(e=t.M)?e:30,u:!0}))}}class z extends E{constructor(t){super(t),this.k=t.k}h(){super.h(),y.fillStyle=function(t,n,e,i,o){const s=y.createRadialGradient(e,i,0,e,i,o);return s.addColorStop(0,"transparent"),s.addColorStop(1,n),s}(0,this.k,this.position.x,this.position.y,this.M),y.arc(this.position.x,this.position.y,this.M,0,2*Math.PI),y.fill()}}class O extends F{constructor(t){var n,e;super(l(h({},t),{M:null!=(n=t.M)?n:5,v:null!=(e=t.v)?e:"#afa",u:!1})),this.P=t.P,this.O=(.1*Math.random()+.1)*(Math.random()<.5?-1:1),this.T=Math.random()*Math.PI*2,this.altitude=50*Math.random()+100}l(t,n){super.l(t,n),this.T+=this.O*(n/1e3),this.position.x=this.altitude*Math.cos(this.T)+this.P.position.x,this.position.y=this.altitude*Math.sin(this.T)+this.P.position.y}}class T extends P{constructor(t){var n,e,i;super(l(h({},t),{p:null!=(n=t.p)?n:3,M:null!=(e=t.M)?e:5,v:null!=(i=t.v)?i:"#d55",u:!1}))}}class A extends g{constructor(t){var n;super(t),this.fontSize=null!=(n=t.fontSize)?n:12,this.text=t.text}h(){super.h(),y.fillStyle="#EEE",y.font=this.fontSize+"px sans-serif";const t=y.measureText(this.text).width;y.fillText(this.text,this.position.x-t/2,this.position.y)}}function C(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}function W(){return parseInt(window.localStorage.getItem("planethoppers-level")||"0")}function D(t){window.localStorage.setItem("planethoppers-level",t.toString())}function G(t,n,e){const i=e.A;if(n instanceof F&&(e.points+=n.points,function(t){const{C:n}=t;null!=n&&t.points>=n&&et()}(e),C(i,n)),n instanceof E&&!t.u){let e;t.u=!0,o=t.position,s=n.position,e=o.x===s.x&&o.y===s.y?t.orientation:b(t.position,n.position)-n.orientation,t.j={P:n,F:e}}var o,s;n instanceof z&&et(),n instanceof T&&(Y=N[X]())}function R(t,n){const e=t.M+n.M;return S(t.position,n.position)<e}function H(t,n){const e=n.A;e.forEach(i=>{i===t||i instanceof k||(t instanceof k?i instanceof P&&R(t,i)&&G(t,i,n):i instanceof O&&t instanceof O||i instanceof P&&t instanceof P&&R(i,t)&&(C(e,t),i.u||C(e,i)))})}function L(t,n,e){y.strokeStyle="#eee",y.font=n+"em sans-serif";const i=w.width/2,o=y.measureText(t).width;y.strokeText(t,i-o/2,e)}function $(t){return()=>{const n=t(),{A:e}=n,i={points:0,A:e,C:n.C};return H(e.find(t=>t instanceof k),i),i}}function q(t,n){const e=new E(t),i=new Array(n).fill(0).map(t=>new O({x:0,y:0,P:e}));return[e,...i]}const I=$(()=>({A:[new k({x:400,y:200,orientation:Math.PI/4}),new E({x:400,y:200,v:"#f00"}),new z({x:800,y:300,v:"#f00",k:"#ff26"}),new A({x:640,y:450,fontSize:32,text:"Welcome to Planet Hoppers!"}),new A({x:640,y:500,fontSize:24,text:"Hold the spacebar to charge your jump"}),new A({x:640,y:550,fontSize:24,text:"release to get to your destination planet!"})]})),U=$(()=>({A:[new k({x:100,y:100,orientation:Math.PI}),new E({x:100,y:100,v:"#0f0",S:.5}),new z({x:300,y:300,v:"#f00",k:"#ff26"}),new A({x:640,y:450,fontSize:32,text:"Some planets will rotate"}),new A({x:640,y:500,fontSize:24,text:"Time your jump just right to get to the destination planet"})]})),B=$(()=>({A:[new k({x:100,y:100,orientation:.75*Math.PI}),new E({x:100,y:100,v:"#0f0"}),new E({x:300,y:300,v:"#ff0",S:.5}),new z({x:700,y:400,v:"#f00",k:"#ff26"})]})),J=$(()=>({C:3,A:[new k({x:300,y:300,orientation:1.5*Math.PI}),...q({x:300,y:300,v:"#0f0",S:1},3),new A({x:640,y:450,fontSize:32,text:"Collect space debris along your way for points"})]}));class K extends g{constructor(t,i){var o;super(t),x(this,e,void 0),x(this,n,void 0),this.W=1e3/t.D,this.G=t.G,this.R=null!=(o=t.R)?o:.1,d(this,e,0),d(this,n,i)}l(t,i){super.l(t,i);const{position:o,W:s,R:r,G:a}=this;for(d(this,e,p(this,e)+i);p(this,e)>s;){console.log("spawning"),d(this,e,p(this,e)-s);const i=r*Math.cos(a),c=r*Math.sin(a);t.A.push(new T(l(h({},p(this,n)),{x:o.x,y:o.y,o:v(i,c)})))}}}e=new WeakMap,n=new WeakMap;const N=[I,U,B,J,$(()=>({A:[new k({x:300,y:300,orientation:1.5*Math.PI}),new K({x:600,y:700,D:2,G:1.1*Math.PI,R:.2}),new K({x:800,y:600,D:2,G:1.3*Math.PI,R:.2}),new E({x:300,y:300,v:"#0f0",S:1}),new z({x:600,y:600,v:"#333",k:"#ff0"}),new A({x:640,y:450,fontSize:32,text:"Avoid asteroids at all costs!"})]})),$(()=>({C:3,A:[new k({x:300,y:300,orientation:1.5*Math.PI}),new K({x:300,y:700,D:.2,G:Math.PI/2,R:.2}),...q({x:300,y:300,v:"#0f0",S:1.4},7),...q({x:700,y:600,v:"#0a0",S:1.4},5)]})),$(()=>({A:[new k({x:400,y:200,orientation:Math.PI/4}),new E({x:400,y:200,v:"#f00",S:10}),new E({x:600,y:300,v:"#00f",S:-10}),new E({x:500,y:600,v:"#0f0",S:10}),new A({x:640,y:450,fontSize:32,text:"Congratulations, you win!"})]}))];let Q=!1;const V=new class{constructor(){this.H=0,this.L="#888",this.$=3,this.q=200;const t=[n()];function n(){return[2e3*Math.random(),2e3*Math.random()]}function e(t,n){return S(v(...t),v(...n))}function i(n){let i=1/0,o=null;for(const s of t){if(!o){o=s,i=e(s,n);continue}const t=e(n,s);t<i&&(o=s,i=t)}return o}function o(){let t,o=0;for(let s=0;s<10;++s){const s=n(),r=e(i(s),s);r>o&&(o=r,t=s)}return t}for(let n=1;n<100;++n)t.push(o());this.I=t}update(t){this.H+=t}U(){const t=this.$,n=this.q;let e=Math.round(this.H/n);this.I.forEach(([n,i])=>{switch(e=(e+1)%4,y.fillStyle=this.L,e){case 0:y.fillRect(n,i,t,t);break;case 1:case 3:y.fillRect(n-t,i,3*t,t),y.fillRect(n,i-t,t,3*t);break;case 2:y.fillRect(n-t,i,3*t,t),y.fillRect(n,i-t,t,3*t),y.fillStyle="#121212",y.fillRect(n,i,t,t)}})}};let X=W();X>=N.length&&(D(0),X=W());let Y=N[X](),Z=!1,_=0;function tt(t){if(Z)return M(),y.fillStyle="#222",y.fillRect(0,0,w.width,w.height),L("Planet Hoppers",6,150),void L("Press Space to Resume",3,300);M();const n=Y.A,e=t-_;var i;_=t,console.debug("FPS: "+1e3/e),function(t,n){const e=t.A;V.update(n);const i=e.find(t=>t instanceof k);if(Q){if(i.u){const t=.2*i.m*n;let e=i.g+t;e>100?(i.m=-1,e-=e-100):e<0&&(i.m=1,e=Math.abs(e)),i.g=e}}else{const t=i.g;if(t){i.g=0,i.m=1,i.u=!1;const{x:n,y:e}=m(i.orientation,.002*t);i.o={x:n,y:e}}}e.forEach(e=>e.l(t,n));const o=e.filter(t=>t instanceof j);o.filter(t=>!t.u).forEach(e=>{e.o=e.o||v(0,0);let i=0,s=0;o.forEach(t=>{if(e===t)return;if(e instanceof k&&!t.u)return;const n=t.position.x-e.position.x||1e-8,o=t.position.y-e.position.y||1e-8,r=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),a=4e-5*e.p/(r*Math.sqrt(r+.5));i+=n*a,s+=o*a}),e.o.x+=i*n,e.o.y+=s*n,e instanceof P&&(e.orientation=Math.atan2(s,i)),e.position.x+=e.o.x*n,e.position.y+=e.o.y*n,H(e,t)})}(Y,e),V.U(),n.forEach(t=>{t.h()}),i=Y,y.fillStyle="#eee",y.font="30px sans-serif",y.fillText("Points: "+i.points,10,40)}function et(){D(++X),Y=N[X]()}function nt(){Z=!0}function st(t){switch(t.key){case"Escape":return void nt();case" ":return t.preventDefault(),Z&&(Z=!1),void(Q=!0);case"r":return D(0),void location.reload();case"n":return;default:console.debug("Unhandled keypress",t.key)}}function it(t){switch(t.key){case" ":t.preventDefault(),Q=!1}}!function(){const t=n=>{tt(n),requestAnimationFrame(t)};requestAnimationFrame(t),addEventListener("blur",nt),addEventListener("keydown",st),addEventListener("keyup",it)}()</script><style>*{margin:0;overflow:hidden}</style><div style=width:100%;height:100%;background-color:#0e0e0e><div style=width:1280;margin:auto><canvas width=1280 height=720 /></div></div>