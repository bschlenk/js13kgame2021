<script type=module>var t,e,n,s=Object.defineProperty,i=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(t,e,n)=>e in t?s(t,e,{t:!0,i:!0,writable:!0,value:n}):t[e]=n,h=(t,e)=>{for(var n in e||(e={}))o.call(e,n)&&u(t,n,e[n]);if(a)for(var n of a(e))c.call(e,n)&&u(t,n,e[n]);return t},l=(t,e)=>i(t,r(e)),f=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},d=(t,e,n)=>(f(t,e,"read from private field"),n?n.call(t):e.get(t)),p=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},x=(t,e,n,o)=>(f(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);const w=document.getElementsByTagName("canvas")[0],M=w.getContext("2d");function v(){M.fillStyle="#121212",M.fillRect(0,0,w.width,w.height)}function y(t,e){return n=t.x-e.x,o=t.y-e.y,Math.atan2(o,n);var n,o}function b(t,e=1){return{x:Math.cos(t)*e,y:Math.sin(t)*e}}class m{constructor(e){var n,o,s;p(this,t,void 0),this.o=l(h({},e),{dx:null!=(n=e.dx)?n:0,dy:null!=(o=e.dy)?o:0}),x(this,t,null==(s=e.u)||s)}h(){}l(t,e){}get u(){return d(this,t)}set u(e){x(this,t,e)}}t=new WeakMap;class S extends m{constructor(t){var e;super(t),this.p=null!=(e=t.p)?e:0}}class j extends S{constructor(t){var e,n,o,s;super(t),this.M=null!=(e=t.M)?e:10,this.v=null!=(n=t.v)?n:"#fff",this.orientation=null!=(o=t.orientation)?o:0,this.m=null!=(s=t.m)?s:0}h(){M.beginPath(),M.fillStyle=function(t,e,n,o,s,i,r){const a=M.createLinearGradient(n,o,n+Math.cos(r)*s,o+Math.sin(r)*i);return a.addColorStop(0,t),a.addColorStop(1,"#000"),a}(this.v,0,this.o.x,this.o.y,2*this.M,2*this.M,this.orientation),M.arc(this.o.x,this.o.y,this.M,0,2*Math.PI),M.fill()}l(t,e){super.l(t,e),this.orientation=(this.orientation+this.m*e/1e3)%(2*Math.PI)}}class g extends j{constructor(t){var e;super(t),this.points=null!=(e=t.points)?e:1}}class F extends j{constructor(t){var e,n,o;super(l(h({},t),{M:null!=(e=t.M)?e:10,v:null!=(n=t.v)?n:"#fff",p:null!=(o=t.p)?o:40,u:!1})),this.S=1,this.j=0,this.g=null,this.u=!1}h(){super.h();const{o:t,j:e,M:n,orientation:o}=this;if(!e)return;M.save(),M.fillStyle="#e43",M.translate(t.x,t.y),M.rotate(o-Math.PI/2);const s=n,i=s/2,r=-i,a=n+i+e;M.fillRect(r,a,s,-e),function(t,...e){M.beginPath(),M.moveTo(...t),e.forEach(t=>{M.lineTo(...t)}),M.fill()}([r,a],[r+s,a],[0,a+i]),M.restore()}l(t,e){super.l(t,e);const n=this.g;if(null!==n){const{F:t,k:e}=n;this.orientation=t.orientation+e;const o=this.M+t.M,{x:s,y:i}=b(this.orientation,o);this.o.x=t.o.x+s,this.o.y=t.o.y+i,this.o.dx=0,this.o.dy=0}}get u(){return super.u}set u(t){super.u=t,!1===t&&(this.g=null)}}class k extends j{constructor(t){var e,n;super(l(h({},t),{p:null!=(e=t.p)?e:30,M:null!=(n=t.M)?n:30,u:!0}))}}class P extends k{constructor(t){super(t),this.P=t.P}h(){super.h(),M.fillStyle=function(t,e,n,o,s){const i=M.createRadialGradient(n,o,0,n,o,s);return i.addColorStop(0,"transparent"),i.addColorStop(1,e),i}(0,this.P,this.o.x,this.o.y,this.M),M.arc(this.o.x,this.o.y,this.M,0,2*Math.PI),M.fill()}}class O extends g{constructor(t){var e,n;super(l(h({},t),{M:null!=(e=t.M)?e:3,v:null!=(n=t.v)?n:"#afa",u:!1})),this.F=t.F,this.O=(.1*Math.random()+.1)*(Math.random()<.5?-1:1),this.T=Math.random()*Math.PI*2,this.altitude=50*Math.random()+100}}class E extends j{constructor(t){var e,n,o;super(l(h({},t),{p:null!=(e=t.p)?e:3,M:null!=(n=t.M)?n:5,v:null!=(o=t.v)?o:"#d55",u:!1}))}}function T(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}function A(){return parseInt(window.localStorage.getItem("planethoppers-level")||"0")}function W(t){window.localStorage.setItem("planethoppers-level",t.toString())}function C(t,e,n){const o=n.A;if(e instanceof g&&(n.points+=e.points,function(t){const{W:e}=t;null!=e&&t.points>=e&&tt()}(n),T(o,e)),e instanceof k&&!t.u){let n;t.u=!0,s=t.o,i=e.o,n=s.x===i.x&&s.y===i.y&&s.dx==s.dx&&s.dy===i.dy?t.orientation:y(t.o,e.o)-e.orientation,t.g={F:e,k:n}}var s,i;e instanceof P&&tt(),e instanceof E&&(V=N[Q]())}function D(t,e){const n=t.M+e.M;return function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}(t.o,e.o)<n}function G(t,e){const n=e.A;n.forEach(o=>{o===t||o instanceof F||(t instanceof F?o instanceof j&&D(t,o)&&C(t,o,e):o instanceof j&&t instanceof j&&D(o,t)&&(T(n,t),o.u||T(n,o)))})}function L(t){return()=>{const e=t(),{A:n}=e,o={points:0,A:n,W:e.W};return G(n.find(t=>t instanceof F),o),o}}function R(t,e){const n=new k(t),o=new Array(e).fill(0).map(t=>new O({x:0,y:0,F:n}));return[n,...o]}const q=L(()=>({A:[new F({x:100,y:100,orientation:Math.PI/4}),new k({x:100,y:100,v:"#f00"}),new P({x:300,y:300,v:"#f00",P:"#ff26"})]})),$=L(()=>({A:[new F({x:100,y:100,orientation:Math.PI}),new k({x:100,y:100,v:"#0f0",m:.3}),new P({x:300,y:300,v:"#f00",P:"#ff26"})]})),H=L(()=>({A:[new F({x:100,y:100,orientation:.75*Math.PI}),new k({x:100,y:100,v:"#0f0"}),new k({x:300,y:300,v:"#ff0",m:.5}),new P({x:700,y:400,v:"#f00",P:"#ff26"})]})),I=L(()=>({W:1,A:[new F({x:300,y:300,orientation:1.5*Math.PI}),...R({x:300,y:300,v:"#0f0",m:1},3)]}));class U extends m{constructor(t,o){var s;super(t),p(this,e,void 0),p(this,n,void 0),this.C=1e3/t.D,this.G=t.G,this.L=null!=(s=t.L)?s:.1,x(this,e,0),x(this,n,o)}l(t,o){super.l(t,o);const{o:s,C:i,L:r,G:a}=this;for(x(this,e,d(this,e)+o);d(this,e)>i;){console.log("spawning"),x(this,e,d(this,e)-i);const o=r*Math.cos(a),c=r*Math.sin(a);t.A.push(new E(l(h({},d(this,n)),{x:s.x,y:s.y,dx:o,dy:c})))}}}e=new WeakMap,n=new WeakMap;const z=L(()=>({A:[new F({x:300,y:300,orientation:1.5*Math.PI}),new U({x:600,y:700,D:2,G:1.1*Math.PI,L:.2}),new U({x:800,y:600,D:2,G:1.3*Math.PI,L:.2}),new k({x:300,y:300,v:"#0f0",m:1}),new P({x:600,y:600,v:"#333",P:"#ff0"})]}));function B(t,e,n){M.strokeStyle="#eee",M.font=e+"em sans-serif";const o=w.width/2,s=M.measureText(t).width;M.strokeText(t,o-s/2,n)}let J=!1;const K=new class{constructor(){this.R=0,this.q="#ffe",this.$=3,this.H=200,this.I=[...Array(100)].map(t=>[Math.round(2e3*Math.random()),Math.round(2e3*Math.random())])}update(t){this.R+=t}U(){const t=this.$,e=this.H;let n=Math.round(this.R/e);this.I.forEach(([e,o])=>{switch(n=(n+1)%4,M.fillStyle=this.q,n){case 0:M.fillRect(e,o,t,t);break;case 1:case 3:M.fillRect(e-t,o,3*t,t),M.fillRect(e,o-t,t,3*t);break;case 2:M.fillRect(e-t,o,3*t,t),M.fillRect(e,o-t,t,3*t),M.fillStyle="#121212",M.fillRect(e,o,t,t)}})}},N=[q,$,H,I,z];let Q=A();Q>=N.length&&(W(0),Q=A());let V=N[Q]();function X(t,e){const n=t.A;K.update(e);const o=n.find(t=>t instanceof F);if(J){if(o.u){const t=.2*o.S*e;let n=o.j+t;n>100?(o.S=-1,n-=n-100):n<0&&(o.S=1,n=Math.abs(n)),o.j=n}}else{const t=o.j;if(t){o.j=0,o.S=1,o.u=!1;const{x:e,y:n}=b(o.orientation,.002*t);o.o.dx=e,o.o.dy=n}}n.forEach(n=>n.l(t,e));const s=n.filter(t=>t instanceof S);s.filter(t=>!t.u).forEach(n=>{var o;if(n instanceof O)return void function(t,e){t.T+=t.O*(e/1e3),t.o.x=t.altitude*Math.cos(t.T)+t.F.o.x,t.o.y=t.altitude*Math.sin(t.T)+t.F.o.y}(n,e);n.o=null!=(o=n.o)?o:{dx:0,dy:0};let i=0,r=0;s.forEach(t=>{if(n===t)return;if(n instanceof F&&!t.u)return;const e=t.o.x-n.o.x||1e-8,o=t.o.y-n.o.y||1e-8,s=Math.sqrt(Math.pow(e,2)+Math.pow(o,2)),a=2e-5*n.p/(s*Math.sqrt(s+.15));i+=e*a,r+=o*a}),n.o.dx+=i*e,n.o.dy+=r*e,n instanceof j&&(n.orientation=Math.atan2(r,i)),n.o.x+=n.o.dx*e,n.o.y+=n.o.dy*e,G(n,t)})}let Y=!1,Z=0;function _(t){if(Y)return v(),M.fillStyle="#222",M.fillRect(0,0,w.width,w.height),B("Planet Hoppers",6,150),void B("Press Space to Resume",3,300);v();const e=V.A,n=t-Z;var o;Z=t,console.debug("FPS: "+1e3/n),X(V,n),K.U(),e.forEach(t=>{t.h()}),o=V,M.fillStyle="#eee",M.font="30px sans-serif",M.fillText("Points: "+o.points,10,40)}function tt(){W(++Q),V=N[Q]()}function et(){Y=!0}function nt(t){switch(t.key){case"Escape":return void et();case" ":return t.preventDefault(),Y&&(Y=!1),void(J=!0);case"r":return W(0),void location.reload();default:console.debug("Unhandled keypress",t.key)}}function st(t){switch(t.key){case" ":t.preventDefault(),J=!1}}!function(){const t=e=>{_(e),requestAnimationFrame(t)};requestAnimationFrame(t),addEventListener("blur",et),addEventListener("keydown",nt),addEventListener("keyup",st)}()</script><style>*{margin:0;overflow:hidden}</style><div style=width:100%;height:100%;background-color:#0e0e0e><div style=width:1280;margin:auto><canvas width=1280 height=720 /></div></div>