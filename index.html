<script type=module>const t=document.getElementsByTagName("canvas")[0],e=t.getContext("2d");function n(){t.width=window.innerWidth,t.height=window.innerHeight}function i(){e.fillStyle="#121212",e.fillRect(0,0,t.width,t.height)}function a(t,e){return n=t.x-e.x,i=t.y-e.y,Math.atan2(i,n);var n,i}function o(t,e=1){return{x:Math.cos(t)*e,y:Math.sin(t)*e}}function s(t,e){const n=t.t+e.t;return function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}(t,e)<n}function r(n,i,o){e.strokeStyle="#eee",e.font=i+"em sans-serif";const a=t.width/2,r=e.measureText(n).width;e.strokeText(n,a-r/2,o)}function c(t){const e=t;return void 0!==e.i&&void 0!==e.o&&void 0!==e.u}function u(t){const e=t;return c(t)&&void 0!==e.t&&void 0!==e.h&&void 0!==e.orientation}function h(t){return"collectible"===t.type}function d(t){return t.l}function f(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}let l=!1;const M=new class{constructor(){this.M=0,this.v="#ffe",this.p=3,this.m=200,this.F=[...Array(100)].map(t=>[Math.round(2e3*Math.random()),Math.round(2e3*Math.random())])}update(t){this.M+=t}G(){const t=this.p,n=this.m;let i=Math.round(this.M/n);this.F.forEach(([n,o])=>{switch(i=(i+1)%4,e.fillStyle=this.v,i){case 0:e.fillRect(n,o,t,t);break;case 1:case 3:e.fillRect(n-t,o,3*t,t),e.fillRect(n,o-t,t,3*t);break;case 2:e.fillRect(n-t,o,3*t,t),e.fillRect(n,o-t,t,3*t),e.fillStyle="#121212",e.fillRect(n,o,t,t)}})}},y={points:0,g:[{x:300,y:200,i:100,o:!1,t:10,h:"#fff",u:!1,orientation:.5*Math.PI,l:!0,k:0,L:1,P:{dx:0,dy:0},type:"player"},{x:300,y:300,i:100,o:!1,t:30,h:"#f00",u:!0,orientation:.5*Math.PI,type:"planet"},{x:600,y:300,i:100,o:!1,t:30,h:"#33f",u:!0,orientation:0,type:"planet"},{x:130,y:305,i:5,o:!1,t:5,h:"#0f0",u:!1,P:{dx:.03,dy:.03},type:"asteroid"},{x:50,y:35,i:5,o:!1,t:5,h:"#0f0",u:!1,P:{dx:.03,dy:-.03},orientation:0,type:"asteroid"}]};function x(t,e){const n=t.g;M.update(e);const i=n.find(d);if(l){if(i.u){const t=.2*i.L*e;let n=i.k+t;n>100?(i.L=-1,n-=n-100):n<0&&(i.L=1,n=Math.abs(n)),i.k=n}}else{const t=i.k;if(t){i.k=0,i.L=1,i.u=!1;const{x:e,y:n}=o(i.orientation,.002*t);i.P.dx=e,i.P.dy=n}}const r=n.filter(c);r.filter(t=>!t.u).forEach(i=>{var c;if(h(i))return void function(t,e){t.j+=t.A*(e/1e3),t.x=t.altitude*Math.cos(t.j)+t.C,t.y=t.altitude*Math.sin(t.j)+t.S}(i,e);i.P=null!=(c=i.P)?c:{dx:0,dy:0};let l=0,y=0;r.forEach(t=>{if(i===t)return;const e=t.x-i.x||1e-8,n=t.y-i.y||1e-8,o=Math.sqrt(Math.pow(e,2)+Math.pow(n,2)),a=2e-5*i.i/(o*Math.sqrt(o+.15));l+=e*a,y+=n*a}),i.P.dx+=l*e,i.P.dy+=y*e,u(i)&&(i.orientation=Math.atan2(y,l)),i.x+=i.P.dx*e,i.y+=i.P.dy*e,n.forEach(e=>{e===i||d(e)||(d(i)?u(e)&&s(i,e)&&function(t,e,n){const i=n.g;if(h(e)&&(n.points+=e.points,f(i,e)),e.u&&!e.points){t.u=!0,t.orientation=a(t,e);const n=t.t+e.t,{x:i,y:r}=o(t.orientation,n);t.x=e.x+i,t.y=e.y+r,t.P.dx=0,t.P.dy=0}}(i,e,t):u(e)&&u(i)&&s(e,i)&&(console.log("Collision!"),f(n,i),e.u||f(n,e)))})})}y.g.forEach(t=>{if("planet"===t.type){const e=Math.floor(10*Math.random()+10),n=[...new Array(e)].map(e=>({x:0,y:0,C:t.x,S:t.y,A:(.1*Math.random()+.1)*(Math.random()<.5?-1:1),j:Math.random()*Math.PI*2,altitude:50*Math.random()+100,points:1,t:3,h:"#fff",orientation:0,i:0,o:!1,u:!1,type:"collectible"}));y.g=y.g.concat(n)}});let v=!1,p=0;function m(n){if(v)return i(),e.fillStyle="#222",e.fillRect(0,0,t.width,t.height),r("Planet Hoppers",6,150),void r("Press Space to Resume",3,300);i();const o=y.g;Math.floor(n/1e3)-Math.floor(p/1e3)&&o.push({x:Math.random()*t.width,y:Math.random()*t.height,i:5,o:!1,t:5,h:"#0f0",u:!1,P:{dx:.03,dy:-.03},orientation:0,type:"asteroid"});const a=n-p;var s;p=n,console.debug("FPS: "+1e3/a),x(y,a),M.G(),o.forEach(t=>{if(u(t)&&(e.beginPath(),e.fillStyle=function(t,n,i,o,a,r,s){const c=e.createLinearGradient(i,o,i+Math.cos(s)*a,o+Math.sin(s)*r);return c.addColorStop(0,t),c.addColorStop(1,"#000"),c}(t.h,0,t.x,t.y,2*t.t,2*t.t,t.orientation),e.arc(t.x,t.y,t.t,0,2*Math.PI),e.fill()),d(t)){const{x:n,y:i,k:o,t:a}=t;if(!o)return;e.fillStyle="#e43";const r=n+a+10,s=i-o;e.fillRect(r,s,10,o)}}),s=y,e.fillStyle="#eee",e.font="30px sans-serif",e.fillText("Points: "+s.points,10,40)}function F(){v=!0}function w(t){switch(t.key){case"Escape":return void F();case" ":return t.preventDefault(),v&&(v=!1),void(l=!0);default:console.debug("Unhandled keypress",t.key)}}function b(t){switch(t.key){case" ":t.preventDefault(),l=!1}}!function(){const t=e=>{m(e),requestAnimationFrame(t)};requestAnimationFrame(t),addEventListener("blur",F),addEventListener("keydown",w),addEventListener("keyup",b),addEventListener("resize",n),n()}()</script><style>*{margin:0;overflow:hidden}</style><canvas/>