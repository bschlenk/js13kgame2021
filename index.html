<script type=module>const t=document.getElementsByTagName("canvas")[0],n=t.getContext("2d");function s(){t.width=window.innerWidth,t.height=window.innerHeight}function e(){n.fillStyle="#121212",n.fillRect(0,0,t.width,t.height)}function i(t,e,i,s,o){n.translate(t,e),n.rotate(o),n.translate(-t,-e),n.fillRect(t,e,i,s),n.setTransform(1,0,0,1,0,0)}class c extends class{constructor(t,n){this.t={x:t,y:n,dx:0,dy:0},this.i=!0}}{constructor(t,n){super(t,n),this.o=0}}class o extends c{constructor(t,n){super(t,n),this.h=10,this.u="#fff",this.orientation=0}}class a extends o{constructor(t,n){super(t,n),this.points=1}}class h extends o{constructor(t,n){super(t,n),this.h=10,this.u="#fff",this.M=1,this.l=0,this.o=40}}class r extends o{constructor(t,n,e){super(t,n),this.u=e,this.h=30,this.o=30}}class f extends a{constructor(t){super(1,1),this.h=3,this.p=t,this.v=(.1*Math.random()+.1)*(Math.random()<.5?-1:1),this.m=Math.random()*Math.PI*2,this.altitude=50*Math.random()+100,this.u="#afa",this.i=!1}}class u extends o{constructor(t,n){super(t,n),this.o=3,this.h=5,this.u="#d55",this.i=!1}}function M(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}function d(t,n){return e=t.x-n.x,i=t.y-n.y,Math.atan2(i,e);var e,i}function l(t,n=1){return{x:Math.cos(t)*n,y:Math.sin(t)*n}}function p(t,n){const e=t.h+n.h;return function(t,n){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}(t.t,n.t)<e}function w(t,n){const e=n.k;e.forEach(i=>{i===t||i instanceof h||(t instanceof h?i instanceof o&&p(t,i)&&function(t,n,e){const i=e.k;if(n instanceof a&&(e.points+=n.points,M(i,n)),n instanceof r){t.i=!0,t.orientation=d(t.t,n.t);const e=t.h+n.h,{x:i,y:s}=l(t.orientation,e);t.t.x=n.t.x+i,t.t.y=n.t.y+s,t.t.dx=0,t.t.dy=0}}(t,i,n):i instanceof o&&t instanceof o&&p(i,t)&&(console.log("Collision!"),M(e,t),i.i||M(e,i)))})}function x(e,i,s){n.strokeStyle="#eee",n.font=i+"em sans-serif";const o=t.width/2,a=n.measureText(e).width;n.strokeText(e,o-a/2,s)}let v=!1;const y=new class{constructor(){this.A=0,this.L="#ffe",this.P=3,this.F=200,this.j=[...Array(100)].map(t=>[Math.round(2e3*Math.random()),Math.round(2e3*Math.random())])}update(t){this.A+=t}q(){const t=this.P,e=this.F;let i=Math.round(this.A/e);this.j.forEach(([e,s])=>{switch(i=(i+1)%4,n.fillStyle=this.L,i){case 0:n.fillRect(e,s,t,t);break;case 1:case 3:n.fillRect(e-t,s,3*t,t),n.fillRect(e,s-t,t,3*t);break;case 2:n.fillRect(e-t,s,3*t,t),n.fillRect(e,s-t,t,3*t),n.fillStyle="#121212",n.fillRect(e,s,t,t)}})}},m={points:0,k:[new h(300,200),new r(300,300,"#f00"),new r(600,300,"#33f")]};let k=[];function E(t,n){const e=t.k;y.update(n);const i=e.find(t=>t instanceof h);if(v){if(i.i){const t=.2*i.M*n;let e=i.l+t;e>100?(i.M=-1,e-=e-100):e<0&&(i.M=1,e=Math.abs(e)),i.l=e}}else{const t=i.l;if(t){i.l=0,i.M=1,i.i=!1;const{x:n,y:e}=l(i.orientation,.002*t);i.t.dx=n,i.t.dy=e}}const s=e.filter(t=>t instanceof c);s.filter(t=>!t.i).forEach(e=>{var i;if(e instanceof f)return void function(t,n){t.m+=t.v*(n/1e3),t.t.x=t.altitude*Math.cos(t.m)+t.p.t.x,t.t.y=t.altitude*Math.sin(t.m)+t.p.t.y}(e,n);e.t=null!=(i=e.t)?i:{dx:0,dy:0};let a=0,r=0;s.forEach(t=>{if(e===t)return;if(e instanceof h&&!t.i)return;const n=t.t.x-e.t.x||1e-8,i=t.t.y-e.t.y||1e-8,s=Math.sqrt(Math.pow(n,2)+Math.pow(i,2)),o=2e-5*e.o/(s*Math.sqrt(s+.15));a+=n*o,r+=i*o}),e.t.dx+=a*n,e.t.dy+=r*n,e instanceof o&&(e.orientation=Math.atan2(r,a)),e.t.x+=e.t.dx*n,e.t.y+=e.t.dy*n,w(e,t)})}m.k.forEach(t=>{if(t instanceof r){const n=Math.floor(10*Math.random()+10),e=new Array(n).fill(0).map(n=>new f(t));k=k.concat(e)}}),m.k=m.k.concat(k);let b=!1,A=0;function L(s){if(b)return e(),n.fillStyle="#222",n.fillRect(0,0,t.width,t.height),x("Planet Hoppers",6,150),void x("Press Space to Resume",3,300);e();const a=m.k;Math.floor(s/1e3)-Math.floor(A/1e3)&&a.push(new u(Math.random()*t.width,Math.random()*t.height));const r=s-A;var c;A=s,console.debug("FPS: "+1e3/r),E(m,r),y.q(),a.forEach(t=>{if(t instanceof o&&(n.beginPath(),n.fillStyle=function(t,e,i,s,o,a,r){const c=n.createLinearGradient(i,s,i+Math.cos(r)*o,s+Math.sin(r)*a);return c.addColorStop(0,t),c.addColorStop(1,"#000"),c}(t.u,0,t.t.x,t.t.y,2*t.h,2*t.h,t.orientation),n.arc(t.t.x,t.t.y,t.h,0,2*Math.PI),n.fill()),t instanceof h){const{t:e,l:s,h:o}=t;if(!s)return;n.fillStyle="#e43";const a=o;i(e.x+(o+a/2)*Math.cos(t.orientation),e.y+(o+a/2)*Math.sin(t.orientation),a,s,t.orientation-Math.PI/2)}}),c=m,n.fillStyle="#eee",n.font="30px sans-serif",n.fillText("Points: "+c.points,10,40)}function P(){b=!0}function F(t){switch(t.key){case"Escape":return void P();case" ":return t.preventDefault(),b&&(b=!1),void(v=!0);default:console.debug("Unhandled keypress",t.key)}}function j(t){switch(t.key){case" ":t.preventDefault(),v=!1}}!function(){const t=n=>{L(n),requestAnimationFrame(t)};requestAnimationFrame(t),addEventListener("blur",P),addEventListener("keydown",F),addEventListener("keyup",j),addEventListener("resize",s),s()}()</script><style>*{margin:0;overflow:hidden}</style><canvas/>