<script type=module>var t,e,n,s=Object.defineProperty,i=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(t,n,e)=>n in t?s(t,n,{t:!0,i:!0,writable:!0,value:e}):t[n]=e,h=(t,n)=>{for(var e in n||(n={}))o.call(n,e)&&u(t,e,n[e]);if(r)for(var e of r(n))c.call(n,e)&&u(t,e,n[e]);return t},f=(t,n)=>i(t,a(n)),l=(t,n,e)=>{if(!n.has(t))throw TypeError("Cannot "+e)},d=(t,n,e)=>(l(t,n,"read from private field"),e?e.call(t):n.get(t)),x=(t,n,e)=>{if(n.has(t))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(t):n.set(t,e)},p=(t,n,e,o)=>(l(t,n,"write to private field"),o?o.call(t,e):n.set(t,e),e);const w=document.getElementsByTagName("canvas")[0],M=w.getContext("2d");function v(){w.width=window.innerWidth,w.height=window.innerHeight}function y(){M.fillStyle="#121212",M.fillRect(0,0,w.width,w.height)}function b(t,n){return e=t.x-n.x,o=t.y-n.y,Math.atan2(o,e);var e,o}function m(t,n=1){return{x:Math.cos(t)*n,y:Math.sin(t)*n}}class S{constructor(n){var e,o,i;x(this,t,void 0),this.o=f(h({},n),{dx:null!=(e=n.dx)?e:0,dy:null!=(o=n.dy)?o:0}),p(this,t,null==(i=n.u)||i)}h(){}l(t,n){}get u(){return d(this,t)}set u(n){p(this,t,n)}}t=new WeakMap;class j extends S{constructor(t){var n;super(t),this.p=null!=(n=t.p)?n:0}}class g extends j{constructor(t){var n,e,o,i;super(t),this.M=null!=(n=t.M)?n:10,this.v=null!=(e=t.v)?e:"#fff",this.orientation=null!=(o=t.orientation)?o:0,this.m=null!=(i=t.m)?i:0}h(){M.beginPath(),M.fillStyle=function(t,n,e,o,i,s,r){const a=M.createLinearGradient(e,o,e+Math.cos(r)*i,o+Math.sin(r)*s);return a.addColorStop(0,t),a.addColorStop(1,"#000"),a}(this.v,0,this.o.x,this.o.y,2*this.M,2*this.M,this.orientation),M.arc(this.o.x,this.o.y,this.M,0,2*Math.PI),M.fill()}l(t,n){super.l(t,n),this.orientation=(this.orientation+this.m*n/1e3)%(2*Math.PI)}}class F extends g{constructor(t){var n;super(t),this.points=null!=(n=t.points)?n:1}}class k extends g{constructor(t){var n,e,o;super(f(h({},t),{M:null!=(n=t.M)?n:10,v:null!=(e=t.v)?e:"#fff",p:null!=(o=t.p)?o:40,u:!1})),this.S=1,this.j=0,this.g=null,this.u=!1}h(){super.h();const{o:t,j:n,M:e,orientation:o}=this;if(!n)return;M.save(),M.fillStyle="#e43",M.translate(t.x,t.y),M.rotate(o-Math.PI/2);const i=e,s=i/2,r=-s,a=e+s+n;M.fillRect(r,a,i,-n),function(t,...n){M.beginPath(),M.moveTo(...t),n.forEach(t=>{M.lineTo(...t)}),M.fill()}([r,a],[r+i,a],[0,a+s]),M.restore()}l(t,n){super.l(t,n);const e=this.g;if(null!==e){const{F:t,k:n}=e;this.orientation=t.orientation+n;const o=this.M+t.M,{x:i,y:s}=m(this.orientation,o);this.o.x=t.o.x+i,this.o.y=t.o.y+s,this.o.dx=0,this.o.dy=0}}get u(){return super.u}set u(t){super.u=t,!1===t&&(this.g=null)}}class P extends g{constructor(t){var n,e;super(f(h({},t),{p:null!=(n=t.p)?n:30,M:null!=(e=t.M)?e:30,u:!0}))}}class O extends P{constructor(t){super(t),this.P=t.P}h(){super.h(),M.fillStyle=function(t,n,e,o,i){const s=M.createRadialGradient(e,o,0,e,o,i);return s.addColorStop(0,"transparent"),s.addColorStop(1,n),s}(0,this.P,this.o.x,this.o.y,this.M),M.arc(this.o.x,this.o.y,this.M,0,2*Math.PI),M.fill()}}class E extends F{constructor(t){var n,e;super(f(h({},t),{M:null!=(n=t.M)?n:3,v:null!=(e=t.v)?e:"#afa",u:!1})),this.F=t.F,this.O=(.1*Math.random()+.1)*(Math.random()<.5?-1:1),this.T=Math.random()*Math.PI*2,this.altitude=50*Math.random()+100}}class T extends g{constructor(t){var n,e,o;super(f(h({},t),{p:null!=(n=t.p)?n:3,M:null!=(e=t.M)?e:5,v:null!=(o=t.v)?o:"#d55",u:!1}))}}function A(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}function L(t,n,e){const o=e.A;if(n instanceof F&&(e.points+=n.points,function(t){const{L:n}=t;null!=n&&t.points>=n&&_()}(e),A(o,n)),n instanceof P&&!t.u){let e;t.u=!0,i=t.o,s=n.o,e=i.x===s.x&&i.y===s.y&&i.dx==i.dx&&i.dy===s.dy?t.orientation:b(t.o,n.o)-n.orientation,t.g={F:n,k:e}}var i,s;n instanceof O&&_(),n instanceof T&&(Q=K[N]())}function W(t,n){const e=t.M+n.M;return function(t,n){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}(t.o,n.o)<e}function C(t,n){const e=n.A;e.forEach(o=>{o===t||o instanceof k||(t instanceof k?o instanceof g&&W(t,o)&&L(t,o,n):o instanceof g&&t instanceof g&&W(o,t)&&(A(e,t),o.u||A(e,o)))})}function D(t){return()=>{const n=t(),{A:e}=n,o={points:0,A:e,L:n.L};return C(e.find(t=>t instanceof k),o),o}}function G(t,n){const e=new P(t),o=new Array(n).fill(0).map(t=>new E({x:0,y:0,F:e}));return[e,...o]}const R=D(()=>({A:[new k({x:100,y:100,orientation:Math.PI/4}),new P({x:100,y:100,v:"#f00"}),new O({x:300,y:300,v:"#f00",P:"#ff26"})]})),q=D(()=>({A:[new k({x:100,y:100,orientation:Math.PI}),new P({x:100,y:100,v:"#0f0",m:.3}),new O({x:300,y:300,v:"#f00",P:"#ff26"})]})),$=D(()=>({A:[new k({x:100,y:100,orientation:.75*Math.PI}),new P({x:100,y:100,v:"#0f0"}),new P({x:300,y:300,v:"#ff0",m:.5}),new O({x:700,y:400,v:"#f00",P:"#ff26"})]})),z=D(()=>({L:1,A:[new k({x:300,y:300,orientation:1.5*Math.PI}),...G({x:300,y:300,v:"#0f0",m:1},3)]}));class H extends S{constructor(t,o){var i;super(t),x(this,e,void 0),x(this,n,void 0),this.W=1e3/t.C,this.D=t.D,this.G=null!=(i=t.G)?i:.1,p(this,e,0),p(this,n,o)}l(t,o){super.l(t,o);const{o:i,W:s,G:r,D:a}=this;for(p(this,e,d(this,e)+o);d(this,e)>s;){console.log("spawning"),p(this,e,d(this,e)-s);const o=r*Math.cos(a),l=r*Math.sin(a);t.A.push(new T(f(h({},d(this,n)),{x:i.x,y:i.y,dx:o,dy:l})))}}}e=new WeakMap,n=new WeakMap;const U=D(()=>({A:[new k({x:300,y:300,orientation:1.5*Math.PI}),new H({x:600,y:700,C:2,D:1.1*Math.PI,G:.2}),new H({x:800,y:600,C:2,D:1.3*Math.PI,G:.2}),new P({x:300,y:300,v:"#0f0",m:1}),new O({x:600,y:600,v:"#333",P:"#ff0"})]}));function B(t,n,e){M.strokeStyle="#eee",M.font=n+"em sans-serif";const o=w.width/2,i=M.measureText(t).width;M.strokeText(t,o-i/2,e)}let I=!1;const J=new class{constructor(){this.R=0,this.q="#ffe",this.$=3,this.H=200,this.U=[...Array(100)].map(t=>[Math.round(2e3*Math.random()),Math.round(2e3*Math.random())])}update(t){this.R+=t}B(){const t=this.$,n=this.H;let e=Math.round(this.R/n);this.U.forEach(([n,o])=>{switch(e=(e+1)%4,M.fillStyle=this.q,e){case 0:M.fillRect(n,o,t,t);break;case 1:case 3:M.fillRect(n-t,o,3*t,t),M.fillRect(n,o-t,t,3*t);break;case 2:M.fillRect(n-t,o,3*t,t),M.fillRect(n,o-t,t,3*t),M.fillStyle="#121212",M.fillRect(n,o,t,t)}})}},K=[R,q,$,z,U];let N=0,Q=K[N]();function V(t,n){const e=t.A;J.update(n);const o=e.find(t=>t instanceof k);if(I){if(o.u){const t=.2*o.S*n;let e=o.j+t;e>100?(o.S=-1,e-=e-100):e<0&&(o.S=1,e=Math.abs(e)),o.j=e}}else{const t=o.j;if(t){o.j=0,o.S=1,o.u=!1;const{x:n,y:e}=m(o.orientation,.002*t);o.o.dx=n,o.o.dy=e}}e.forEach(e=>e.l(t,n));const i=e.filter(t=>t instanceof j);i.filter(t=>!t.u).forEach(e=>{var o;if(e instanceof E)return void function(t,n){t.T+=t.O*(n/1e3),t.o.x=t.altitude*Math.cos(t.T)+t.F.o.x,t.o.y=t.altitude*Math.sin(t.T)+t.F.o.y}(e,n);e.o=null!=(o=e.o)?o:{dx:0,dy:0};let s=0,r=0;i.forEach(t=>{if(e===t)return;if(e instanceof k&&!t.u)return;const n=t.o.x-e.o.x||1e-8,o=t.o.y-e.o.y||1e-8,i=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),a=2e-5*e.p/(i*Math.sqrt(i+.15));s+=n*a,r+=o*a}),e.o.dx+=s*n,e.o.dy+=r*n,e instanceof g&&(e.orientation=Math.atan2(r,s)),e.o.x+=e.o.dx*n,e.o.y+=e.o.dy*n,C(e,t)})}let X=!1,Y=0;function Z(t){if(X)return y(),M.fillStyle="#222",M.fillRect(0,0,w.width,w.height),B("Planet Hoppers",6,150),void B("Press Space to Resume",3,300);y();const n=Q.A,e=t-Y;var o;Y=t,console.debug("FPS: "+1e3/e),V(Q,e),J.B(),n.forEach(t=>{t.h()}),o=Q,M.fillStyle="#eee",M.font="30px sans-serif",M.fillText("Points: "+o.points,10,40)}function _(){Q=K[++N]()}function tt(){X=!0}function et(t){switch(t.key){case"Escape":return void tt();case" ":return t.preventDefault(),X&&(X=!1),void(I=!0);default:console.debug("Unhandled keypress",t.key)}}function nt(t){switch(t.key){case" ":t.preventDefault(),I=!1}}!function(){const t=n=>{Z(n),requestAnimationFrame(t)};requestAnimationFrame(t),addEventListener("blur",tt),addEventListener("keydown",et),addEventListener("keyup",nt),addEventListener("resize",v),v()}()</script><style>*{margin:0;overflow:hidden}</style><canvas/>